{% extends "layout.html" %}
{% block title %}{% endblock %} {% block head %}
{{ super() }}
{% endblock %}
{% block content %}
<script>
  let id = "{{ id }}"

  $(document).ready(function () {
          getReply();
 });

 $(function get_details() {
      $.ajax({
          type: "GET",
          url: '/api/details',
          data: {
            id:id,
          },
          success: function (response) {
              let res = response['result']
              const videoLink = res.link.replace("https://www.youtube.com/watch?v=", " ")
              const video = ` <div id="${res._id}">
                                <iframe width="872" height="486" src="https://www.youtube.com/embed/${videoLink.replace(/\s/gi, "")}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                    <div class="flex-center">
                                        <h2>${res.title}</h2>
                                        <div>
                                            <span class="likeNum">0</span>
                                            <button onclick="toggle_like(${res._id})">
                                                <i class="fas fa-heart"></i>LIKE
                                            </button>
                                    </div>
                                </div>
                              </div>
                            `
              $('.videoBox').append(video)

          }
      })
  }
 )
function toggle_like(post_id) {
    let PostId = post_id
    console.log(post_id)
    let $a_like = $(`#${PostId}`)
    let $i_like = $a_like.find("i")
    $.ajax({
            type: "POST",
            url: "/update_like",
            data: {
                post_id_give: post_id,
                action_give: "unlike"
            },
            success: function (response) {
                console.log("unlike")
                $i_like.addClass("fa-heart-o").removeClass("fa-heart")
                $a_like.find("span.like-num").text(response["count"])
            }
    })
}

   //  function postLike(like) {
   //        $.ajax({
   //            type: "POST",
   //            url: '/api/like',
   //            data: {
   //              like:like,
   //            },
   //            success: function (response) {
   //                let res = response['result']
   //                console.log(res)
   //            }
   //        })
   //    }
   // function count(type)  {
   //    const resultElement = document.querySelector('.likeNum');
   //    let number = resultElement.innerText;
   //    if(type === 'plus') {
   //      number = parseInt(number) + 1;
   //    }else if(type === 'minus')  {
   //      number = parseInt(number) - 1;
   //    }
   //       postLike(number)
   //  }

#댓글 전송
    function reply(){
    let comment = $("#msg").val();
    if(comment ==""){
      alert("메세지를 입력하세요")
    }
    $.ajax({
         type: "POST",
         url: '/api/comment',
         data: {
           comment:comment,
           replyBoardId:id
         },
         success: function (response) {
          window.location.reload();
         }
     });
 }

#댓글 전체 조회
 function getReply() {
                    $.ajax({
                        type: "GET",
                        url: "/api/comments",
                        data: {
                            replyBoardId: id
                        },
                        success: function (response) {
                            let res = response['result']
                            console.log(res)
                            for (let i = 0; i < res.length; i++) {
                                console.log(res[i].comment)
                                let commentId = res[i]._id
                                let comment = res[i].comment
                                let username = res[i].username
                                let html =
                                                    `
                            <div class="commentName flex">
                                <div>
                                 <p id="commentId" style="display:none">${commentId}</p>
                                 <p id="userReplyName">${username}</p>
                                 <p id="text">${comment}</p>
                                </div>
                                <div>
                                 <button class="delBtn" onclick="deleteBtn()"><i class="fas fa-times"></i></button>
                                 <button class="modifyBtn"><i class="fas fa-redo"></i></button>
                               </div>
                            </div>
                              `
                                $('#reply').append(html)
                                                }
                        }
                    });
                }
# 댓글삭제
function deleteBtn(){
    console.log(commentId)

     $.ajax({
         type: "DELETE",
         url: '/api/comment',
         data: {

         },
         success: function (response) {
          location.reload();
         }
     });
 }
</script>
<body>
 <div class="videoBox">
</div>
<div class="commentBox">
    <div class="commentWindow">
        <ul>
            <li class="comment" id="comment">
                <p id="reply"></p>
            </li>
        </ul>
    </div>
    <div>
        <p class="text"></p>
        <input type="text" id="msg">
        <button id="comment_btn" type="button" onclick="reply()"></button>
    </div>

</div>
</body>
{% endblock %}